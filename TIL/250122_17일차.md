

### 오늘 한 것

#### MySQL

- 인덱스, 뷰
- window함수(FIRST_VALUE, LAG, LEAD, PERCENT_RANK, CUME_DIST, NTILE...)

  
***


### 발견 discovery

- FROM절에서 서브쿼리를 적용하고자 한다면 별칭을 정해줘야 함

#### index

    CREATE TABLE  tbl5(   
        a INT UNIQUE NOT NULL,
        b INT UNIQUE ,
        c INT UNIQUE,
        d INT PRIMARY KEY
    );
    SHOW INDEX FROM tbl5; 

- 가장 우선시 되는 인덱스 : d(PK)


#### WINDOW 함수

1) 누적합 계산

        SELECT
          empno, ename, job, sal,
          SUM(sal) OVER (PARTITION BY job ORDER BY sal DESC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cumulative_sal
        FROM emp;

2) 이동평균 계산: 현재 행과 이전 두 행의 평균

        SELECT
            empno, ename, job, sal,
            AVG(sal) OVER (PARTITION BY job ORDER BY sal DESC ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS moving_avg
        FROM emp;


3) 특정 범위 내의 합계: 현재 행과 다음 N개 행의 합계

        SELECT
            empno, ename, job, sal,
            SUM(sal) OVER (PARTITION BY job ORDER BY sal DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING) AS range_sum
        FROM emp;

***


### 배운점 learned

#### 인덱스

- 해시 알고리즘 : 인덱스를 타고 타고 들어가서 검색
- 인덱스가 잘 걸려 있다면 서브 쿼리보다 조인이 빠른 속도를 가질 수 있게 됨
- 중복된 데이터가 많은 열에 인덱스를 생성하는 것은 성능에 나쁜 영향을 미침

**효과적으로 인덱스 사용하기**

- WHERE 절에 많이 사용되는 열
- 자주 사용하는 컬럼
- 사용하지 않는 것은 제거

#### 뷰

- **외부에서는 테이블과 구분할 수 없음!!!!!**
- 볼 수는 있지만 변경하거나 터치할 수 없음 _ 창 밖 풍경에 손을 댈 수 없듯이
- 보안을 고려해야 하는 특정 컬럼값 은닉 간으
- 여러 개의 테이블의 조인된 데이터를 다수 활용해야 하는 경우
- **조인된 결과의 새로운 테이블 자체를 가상으로 DB 내에 생성시킬 수 있는 방법**


#### WINDOW 함수

1) **순위 함수**

- RANK
- DENSE_RANK - 중복으로 인한 중간 순위를 비우지 않음
- ROW_NUMBER - 행 순서대로 고유한 값을 부여
    - COLLATION 순서대로 번호가 매겨짐

2) **일반 집계 함수**: SUM, MAX, MIN, AVG, COUNT
   
3) **그룹 내 행 순서 함수**
- FIRST_VALUE: partition별 윈도우에서 가장 먼저 나온 값을 구함
- LAG: 이전 몇 번째 행의 값을 가져오는 함수
  - 인자 최대 3개(두번째 인자: 몇 번째 앞의 행을 가져올 것인지, 세번째 인자: default)
  - default값으로는 group by 연산을 요구하는 것은 사용 불가
- LEAD: 이후 몇 번째 행의 값을 가져오는 함수

4) **그룹 내 비율 함수**
- PERCENT_RANK
- CUME_DIST: 누적 비율
  
      SELECT job, ename, sal,
        cume_dist() OVER(PARTITION BY job ORDER BY sal asc)
      from emp;
  
- NTILE: 전체 데이터를 특정 기준으로 N개의 그룹으로 나눔
    - bin처럼 max와 min 사이에 비율을 적절하게 나누어서 N개의 tile을 만들어서 분배
    - 아이디 별로 접속 빈도를 따져서 고관여, 저관여 이용자로 구분하여 사용 가능


           SELECT job, ename, sal,
              NTILE(5) OVER(ORDER BY sal asc) AS '많이 받는 순서대로 그룹'
            FROM emp;
          
   
***

### 선언 declaration

수업 시간에 집중하기 !-! 🐱‍🏍

***

### 자습 Self study

#### 
